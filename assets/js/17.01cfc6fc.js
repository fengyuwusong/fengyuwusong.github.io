(window.webpackJsonp=window.webpackJsonp||[]).push([[17],{356:function(s,t,a){"use strict";a.r(t);var n=a(0),e=Object(n.a)({},(function(){var s=this,t=s._self._c;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h3",{attrs:{id:"前言"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#前言"}},[s._v("#")]),s._v(" 前言")]),s._v(" "),t("p",[s._v("一般来说，在开发过程中我们的应用都会遇上各种问题场景，下面关于以下几种常见场景的排查分析问题常见方法进行一定的总结：")]),s._v(" "),t("ul",[t("li",[s._v("分析程序运行时间和CPU利用率情况")]),s._v(" "),t("li",[s._v("分析golang程序内存占用情况")]),s._v(" "),t("li",[s._v("分析golang程序CPU性能情况")])]),s._v(" "),t("h3",{attrs:{id:"场景1-如何分析程序的运行时间与cpu利用率情况"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#场景1-如何分析程序的运行时间与cpu利用率情况"}},[s._v("#")]),s._v(" 场景1： 如何分析程序的运行时间与CPU利用率情况？")]),s._v(" "),t("h4",{attrs:{id:"_1-shell内置time指令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-shell内置time指令"}},[s._v("#")]),s._v(" (1) shell内置time指令")]),s._v(" "),t("p",[s._v("这个方法不算新颖，但是确很实用。 time是Unix/Linux内置多命令，使用时一般不用传过多参数，直接跟上需要调试多程序即可。")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" go run test2.go\n"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" 张三 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\nreal 0m0.843s\nuser 0m0.216s\nsys 0m0.389s\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("上面是使用time对 go run test2.go对执行程序坐了性能分析，得到3个指标。")]),s._v(" "),t("p",[s._v("● real：从程序开始到结束，实际度过的时间；\n● user：程序在用户态度过的时间；\n● sys：程序在内核态度过的时间。")]),s._v(" "),t("p",[s._v("一般情况下 "),t("code",[s._v("real >= user + sys")]),s._v("，因为系统还有其它进程(切换其他进程中间对于本进程会有空白期)。")]),s._v(" "),t("h3",{attrs:{id:"_2-usr-bin-time指令"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-usr-bin-time指令"}},[s._v("#")]),s._v(" 2) /usr/bin/time指令")]),s._v(" "),t("p",[s._v("这个指令比内置的time更加详细一些，使用的时候需要用绝对路径，而且"),t("strong",[s._v("要加上参数-v")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ /usr/bin/time "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-v")]),s._v(" go run test2.go  \n\n Command being timed: "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"go run test2.go"')]),s._v("\n User "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("seconds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.12")]),s._v("\n System "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("seconds"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.06")]),s._v("\n Percent of CPU this job got: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("115")]),s._v("%\n Elapsed "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("wall clock"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("h:mm:ss or m:ss"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(":00.16\n Average shared text size "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kbytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n Average unshared data size "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kbytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n Average stack size "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kbytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n Average total size "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kbytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n Maximum resident "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" size "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kbytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("41172")]),s._v("\n Average resident "),t("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("set")]),s._v(" size "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("kbytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n Major "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("requiring I/O"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" page faults: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n Minor "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("reclaiming a frame"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" page faults: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15880")]),s._v("\n Voluntary context switches: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("897")]),s._v("\n Involuntary context switches: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("183")]),s._v("\n Swaps: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n File system inputs: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("256")]),s._v("\n File system outputs: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2664")]),s._v("\n Socket messages sent: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n Socket messages received: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n Signals delivered: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n Page size "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(": "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4096")]),s._v("\n Exit status: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br")])]),t("p",[s._v("可以看到这里的功能要强大多了，除了之前的信息外，还包括了：")]),s._v(" "),t("p",[s._v("● CPU占用率；\n● 内存使用情况；\n● Page Fault 情况；\n● 进程切换情况；\n● 文件系统IO；\n● Socket 使用情况；\n● ……")]),s._v(" "),t("h3",{attrs:{id:"场景2-如何分析golang程序的内存使用情况"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#场景2-如何分析golang程序的内存使用情况"}},[s._v("#")]),s._v(" 场景2： 如何分析golang程序的内存使用情况？")]),s._v(" "),t("h4",{attrs:{id:"_1-内存占用情况查看"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-内存占用情况查看"}},[s._v("#")]),s._v(" (1) 内存占用情况查看")]),s._v(" "),t("p",[s._v("我们先写一段demo例子代码")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" main\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"log"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"runtime"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"time"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("test")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//slice 会动态扩容，用slice来做堆内存申请")]),s._v("\n    container "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" ===> loop begin."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        container "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("append")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("container"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" ===> loop end."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Start."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("test")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"force gc."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    runtime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("GC")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//强制调用gc回收")]),s._v("\n\n    log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Done."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Second"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//睡眠，保持程序不退出")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br")])]),t("p",[s._v("编译")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$go")]),s._v(" build "),t("span",{pre:!0,attrs:{class:"token parameter variable"}},[s._v("-o")]),s._v(" snippet_mem "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" ./snippet_mem\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("然后在"),t("code",[s._v("./snippet_mem")]),s._v("进程没有执行完，我们再开一个窗口，通过top命令查看进程的内存占用情况")]),s._v(" "),t("p",[t("code",[s._v("$top -p $(pidof snippet_mem)")])]),s._v(" "),t("p",[s._v("得到结果如下：")]),s._v(" "),t("p",[t("img",{attrs:{src:"https://pic.fengyuwusong.cn/20220506100834.png",alt:"top结果"}})]),s._v(" "),t("p",[s._v("我们看出来，没有退出的snippet_mem进程有约770m的内存被占用。")]),s._v(" "),t("p",[s._v("直观上来说，这个程序在test()函数执行完后，切片contaner的内存应该被释放，不应该占用770m那么大。")]),s._v(" "),t("p",[s._v("下面让我们使用GODEBUG来分析程序的内存使用情况。")]),s._v(" "),t("h4",{attrs:{id:"_2-godebug与gctrace"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-godebug与gctrace"}},[s._v("#")]),s._v(" (2) GODEBUG与gctrace")]),s._v(" "),t("ul",[t("li",[s._v("用法")])]),s._v(" "),t("p",[s._v("执行"),t("code",[s._v("snippet_mem")]),s._v("程序之前添加环境变量"),t("code",[s._v("GODEBUG='gctrace=1'")]),s._v("来跟踪打印垃圾回收器信息")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GODEBUG")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'gctrace=1'")]),s._v(" ./snippet_mem\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("设置"),t("code",[s._v("gctrace=1")]),s._v("会使得垃圾回收器在每次回收时汇总所回收内存的大小以及耗时，\n并将这些内容汇总成单行内容打印到标准错误输出中。")]),s._v(" "),t("ul",[t("li",[s._v("格式")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("gc "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# @#s #%: #+#+# ms clock, #+#/#/#+# ms cpu, #->#-># MB, # MB goal, # P")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("ul",[t("li",[s._v("含义")])]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v(" gc "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#        GC次数的编号，每次GC时递增")]),s._v("\n @"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#s         距离程序开始执行时的时间")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#%          GC占用的执行时间百分比")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#+...+#     GC使用的时间")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#->#-># MB  GC开始，结束，以及当前活跃堆内存的大小，单位M")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# MB goal   全局堆内存大小")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# P         使用processor的数量")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br")])]),t("p",[s._v("如果每条信息最后，以(forced)结尾，那么该信息是由runtime.GC()调用触发")]),s._v(" "),t("p",[s._v("我们来选择其中一行来解释一下：")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("gc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" @0.149s "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("%: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.004")]),s._v("+36+0.003 ms clock, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.009")]),s._v("+0/0.051/36+0.006 ms cpu, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("181")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("181")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("101")]),s._v(" MB, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("182")]),s._v(" MB goal, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" P\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("该条信息含义如下：")]),s._v(" "),t("p",[s._v("● gc 17: Gc 调试编号为17\n● @0.149s:此时程序已经执行了0.149s\n● 1%: 0.149s中其中gc模块占用了1%的时间\n● 0.004+36+0.003 ms clock: 垃圾回收的时间，分别为STW（stop-the-world）清扫的时间+并发标记和扫描的时间+STW标记的时间\n● 0.009+0/0.051/36+0.006 ms cpu: 垃圾回收占用cpu时间\n● 181->181->101 MB： GC开始前堆内存181M， GC结束后堆内存181M，当前活跃的堆内存101M\n● 182 MB goal: 全局堆内存大小\n● 2 P: 本次GC使用了2个P(调度器中的Processer)")]),s._v(" "),t("p",[s._v("了解了GC的调试信息读法后，接下来我们来分析一下本次GC的结果。")]),s._v(" "),t("p",[s._v("我们还是执行GODEBUG调试")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GODEBUG")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'gctrace=1'")]),s._v(" ./snippet_mem\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("结果如下")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("➜  study git:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("main"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" ✗ "),t("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("GODEBUG")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v("'gctrace=1'")]),s._v(" ./main\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/05/06 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":16:30 Start.\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/05/06 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":16:30  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" loop begin.\ngc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" @0.001s "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("%: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.008")]),s._v("+0.42+0.002 ms clock, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.017")]),s._v("+0/0.10/0.33+0.004 ms cpu, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" MB, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" MB goal, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" P\ngc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" @0.002s "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("%: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.006")]),s._v("+1.6+0.003 ms clock, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.012")]),s._v("+0/0.10/0.59+0.006 ms cpu, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" MB, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" MB goal, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" P\ngc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" @0.004s "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("%: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.007")]),s._v("+1.4+0.001 ms clock, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.014")]),s._v("+0/0.10/1.3+0.003 ms cpu, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" MB, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" MB goal, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" P\ngc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" @0.006s "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v("%: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.017")]),s._v("+0.49+0.001 ms clock, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.034")]),s._v("+0.11/0/0+0.003 ms cpu, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(" MB, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" MB goal, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" P\ngc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" @0.007s "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("%: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.32")]),s._v("+0.54+0.001 ms clock, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.65")]),s._v("+0.020/0.41/0+0.003 ms cpu, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" MB, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" MB goal, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" P\ngc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" @0.008s "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("%: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.006")]),s._v("+2.5+0.002 ms clock, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.013")]),s._v("+0.005/0.075/2.4+0.005 ms cpu, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v(" MB, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" MB goal, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" P\ngc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v(" @0.011s "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("%: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.024")]),s._v("+2.5+0.003 ms clock, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.048")]),s._v("+0.020/0.91/0+0.006 ms cpu, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(" MB, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" MB goal, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" P\ngc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" @0.014s "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v("%: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.11")]),s._v("+1.7+0.001 ms clock, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.23")]),s._v("+0.10/0/0+0.003 ms cpu, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(" MB, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" MB goal, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" P\ngc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9")]),s._v(" @0.016s "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("7")]),s._v("%: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.007")]),s._v("+5.4+0.004 ms clock, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.015")]),s._v("+0/0.074/5.1+0.008 ms cpu, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" MB, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" MB goal, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" P\ngc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" @0.021s "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("%: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.007")]),s._v("+1.4+0.002 ms clock, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.014")]),s._v("+0/0.076/1.2+0.005 ms cpu, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" MB, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("25")]),s._v(" MB goal, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" P\ngc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(" @0.023s "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v("%: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.007")]),s._v("+3.0+0.003 ms clock, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.014")]),s._v("+0/0.083/2.9+0.007 ms cpu, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" MB, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("31")]),s._v(" MB goal, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" P\ngc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(" @0.027s "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v("%: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.050")]),s._v("+9.4+0.004 ms clock, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.10")]),s._v("+0.012/7.2/0.009+0.008 ms cpu, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("38")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("38")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" MB, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("39")]),s._v(" MB goal, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" P\ngc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v(" @0.037s "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("13")]),s._v("%: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.007")]),s._v("+2.7+0.003 ms clock, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.014")]),s._v("+0/0.091/2.5+0.006 ms cpu, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("47")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("47")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v(" MB, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("48")]),s._v(" MB goal, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" P\ngc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14")]),s._v(" @0.040s "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v("%: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.084")]),s._v("+5.8+0.003 ms clock, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.16")]),s._v("+0.021/5.3/0+0.007 ms cpu, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("59")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("59")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33")]),s._v(" MB, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v(" MB goal, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" P\ngc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15")]),s._v(" @0.046s "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("26")]),s._v("%: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.027")]),s._v("+19+0.004 ms clock, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.054")]),s._v("+0.022/19/0+0.009 ms cpu, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("74")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("74")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("41")]),s._v(" MB, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("75")]),s._v(" MB goal, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" P\ngc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),s._v(" @0.066s "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),s._v("%: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.007")]),s._v("+5.2+0.003 ms clock, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.014")]),s._v("+0/0.11/4.9+0.007 ms cpu, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("93")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("93")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("51")]),s._v(" MB, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("94")]),s._v(" MB goal, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" P\ngc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("17")]),s._v(" @0.072s "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("27")]),s._v("%: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.008")]),s._v("+10+0.005 ms clock, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.017")]),s._v("+0.010/10/0.010+0.010 ms cpu, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("116")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("116")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("64")]),s._v(" MB, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("117")]),s._v(" MB goal, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" P\ngc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v(" @0.084s "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("18")]),s._v("%: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.007")]),s._v("+40+0.005 ms clock, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.015")]),s._v("+0/0.080/39+0.010 ms cpu, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("145")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("145")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("145")]),s._v(" MB, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("146")]),s._v(" MB goal, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" P\ngc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19")]),s._v(" @0.167s "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v("%: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.016")]),s._v("+59+0.004 ms clock, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.032")]),s._v("+0/0.082/58+0.009 ms cpu, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("372")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("372")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("126")]),s._v(" MB, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("373")]),s._v(" MB goal, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" P\ngc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20")]),s._v(" @0.227s "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v("%: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.34")]),s._v("+15+0.015 ms clock, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.69")]),s._v("+0/14/0+0.030 ms cpu, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("284")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("284")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("284")]),s._v(" MB, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("285")]),s._v(" MB goal, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" P\ngc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/05/06 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":16:30  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" loop end.\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("21")]),s._v(" @0.3242022/05/06 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":16:30 force gc.\ns "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("%: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.014")]),s._v("+198+0.003 ms clock, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.029")]),s._v("+0/0.089/198+0.006 ms cpu, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("728")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("728")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" MB, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("729")]),s._v(" MB goal, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" P\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/05/06 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":16:30 Done.\ngc "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22")]),s._v(" @0.523s "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5")]),s._v("%: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.006")]),s._v("+2.4+0.002 ms clock, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0.013")]),s._v("+0/0.045/2.4+0.005 ms cpu, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("-"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" MB, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4")]),s._v(" MB goal, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v(" P "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("forced"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("```\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br")])]),t("ul",[t("li",[s._v("分析")])]),s._v(" "),t("p",[s._v("先看在test()函数执行完后立即打印的gc 21那行的信息。"),t("code",[s._v("728->728->0 MB, 729 MB goal")]),s._v("表示垃圾回收器已经把729M的内存标记为非活跃的内存。")]),s._v(" "),t("p",[s._v("再看下一个记录"),t("code",[s._v("gc 22。0->0->0 MB, 4 MB goal")]),s._v("表示垃圾回收器中的全局堆内存大小由729M下降为4M。")]),s._v(" "),t("ul",[t("li",[s._v("结论")])]),s._v(" "),t("p",[s._v("1、在test()函数执行完后，demo程序中的切片容器所申请的堆空间都被垃圾回收器回收了。")]),s._v(" "),t("p",[s._v("2、如果此时在top指令查询内存的时候，如果依然是800+MB，说明垃圾回收器回收了应用层的内存后，（可能）并不会立即将内存归还给系统。")]),s._v(" "),t("h4",{attrs:{id:"_3-runtime-readmemstats"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3-runtime-readmemstats"}},[s._v("#")]),s._v(" (3) runtime.ReadMemStats")]),s._v(" "),t("p",[s._v("接下来我么换另一种方式查看内存的方式 利用 runtime库里的ReadMemStats()方法")]),s._v(" "),t("p",[s._v("demo2.go")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" main\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"log"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"runtime"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"time"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("readMemStats")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" ms runtime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("MemStats\n\n    runtime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ReadMemStats")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("ms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Printf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" ===> Alloc:%d(bytes) HeapIdle:%d(bytes) HeapReleased:%d(bytes)"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Alloc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("HeapIdle"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("HeapReleased"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("test")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//slice 会动态扩容，用slice来做堆内存申请")]),s._v("\n    container "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" ===> loop begin."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        container "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("append")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("container"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("readMemStats")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" ===> loop end."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" ===> [Start]."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("readMemStats")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("test")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("readMemStats")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" ===> [force gc]."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    runtime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("GC")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//强制调用gc回收")]),s._v("\n\n    log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" ===> [Done]."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("readMemStats")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("go")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("readMemStats")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Second"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Second"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//睡眠，保持程序不退出")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br")])]),t("p",[s._v("这里我们， 封装了一个函数readMemStats()，这里面主要是调用runtime中的ReadMemStats()方法获得内存信息，然后通过log打印出来。")]),s._v(" "),t("p",[s._v("我们执行一下代码并运行")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("➜  study git:"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("main"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" ✗ go run demo2.go \n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/05/06 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":21:59  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Start"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/05/06 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":21:59  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Alloc:63872"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" HeapIdle:66592768"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" HeapReleased:66560000"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/05/06 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":21:59  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" loop begin.\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/05/06 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":21:59  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Alloc:238511072"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" HeapIdle:96509952"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" HeapReleased:96378880"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/05/06 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":21:59  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" loop end.\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/05/06 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":21:59  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Alloc:631416280"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" HeapIdle:173424640"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" HeapReleased:141795328"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/05/06 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":21:59  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("force gc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/05/06 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":21:59  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("Done"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(".\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/05/06 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":21:59  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Alloc:51040"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" HeapIdle:804790272"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" HeapReleased:141795328"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/05/06 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":21:59  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Alloc:52064"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" HeapIdle:804782080"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" HeapReleased:141787136"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/05/06 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":22:09  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Alloc:52272"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" HeapIdle:804782080"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" HeapReleased:141795328"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2022")]),s._v("/05/06 "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(":22:19  "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" Alloc:52416"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" HeapIdle:804782080"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" HeapReleased:202391552"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br")])]),t("p",[s._v("可以看到，打印[Done].之后那条trace信息，Alloc已经下降，即内存已被垃圾回收器回收。在2022/05/06 10:22:19的这条trace信息中，HeapReleased开始上升，即垃圾回收器把内存归还给系统。")]),s._v(" "),t("p",[s._v("另外，MemStats还可以获取其它哪些信息以及字段的含义可以参见"),t("a",{attrs:{href:"http://golang.org/pkg/runtime/#MemStats",target:"_blank",rel:"noopener noreferrer"}},[s._v("官方文档"),t("OutboundLink")],1)]),s._v(" "),t("h4",{attrs:{id:"_4-pprof工具"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_4-pprof工具"}},[s._v("#")]),s._v(" (4) pprof工具")]),s._v(" "),t("p",[s._v("pprof工具支持网页上查看内存的使用情况，需要在代码中添加一个协程即可。")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"net/http"')]),s._v("\n "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("_")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"net/http/pprof"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("go")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ListenAndServe")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0:10000"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n具体添加的完整代码如下：\n\ndemo3"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("go")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" main\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"log"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"runtime"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"time"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"net/http"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("_")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"net/http/pprof"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("readMemStats")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" ms runtime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("MemStats\n\n    runtime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ReadMemStats")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("ms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Printf")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" ===> Alloc:%d(bytes) HeapIdle:%d(bytes) HeapReleased:%d(bytes)"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Alloc"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("HeapIdle"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" ms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("HeapReleased"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("test")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//slice 会动态扩容，用slice来做堆内存申请")]),s._v("\n    container "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("make")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("int")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" ===> loop begin."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("32")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        container "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("append")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("container"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("==")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("16")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("readMemStats")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" ===> loop end."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//启动pprof")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("go")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ListenAndServe")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0:10000"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" ===> [Start]."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("readMemStats")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("test")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("readMemStats")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" ===> [force gc]."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    runtime"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("GC")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//强制调用gc回收")]),s._v("\n\n    log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" ===> [Done]."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("readMemStats")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("go")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("readMemStats")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Second"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Second"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//睡眠，保持程序不退出")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br"),t("span",{staticClass:"line-number"},[s._v("47")]),t("br"),t("span",{staticClass:"line-number"},[s._v("48")]),t("br"),t("span",{staticClass:"line-number"},[s._v("49")]),t("br"),t("span",{staticClass:"line-number"},[s._v("50")]),t("br"),t("span",{staticClass:"line-number"},[s._v("51")]),t("br"),t("span",{staticClass:"line-number"},[s._v("52")]),t("br"),t("span",{staticClass:"line-number"},[s._v("53")]),t("br"),t("span",{staticClass:"line-number"},[s._v("54")]),t("br"),t("span",{staticClass:"line-number"},[s._v("55")]),t("br"),t("span",{staticClass:"line-number"},[s._v("56")]),t("br"),t("span",{staticClass:"line-number"},[s._v("57")]),t("br"),t("span",{staticClass:"line-number"},[s._v("58")]),t("br"),t("span",{staticClass:"line-number"},[s._v("59")]),t("br"),t("span",{staticClass:"line-number"},[s._v("60")]),t("br"),t("span",{staticClass:"line-number"},[s._v("61")]),t("br"),t("span",{staticClass:"line-number"},[s._v("62")]),t("br"),t("span",{staticClass:"line-number"},[s._v("63")]),t("br"),t("span",{staticClass:"line-number"},[s._v("64")]),t("br"),t("span",{staticClass:"line-number"},[s._v("65")]),t("br"),t("span",{staticClass:"line-number"},[s._v("66")]),t("br"),t("span",{staticClass:"line-number"},[s._v("67")]),t("br"),t("span",{staticClass:"line-number"},[s._v("68")]),t("br"),t("span",{staticClass:"line-number"},[s._v("69")]),t("br"),t("span",{staticClass:"line-number"},[s._v("70")]),t("br"),t("span",{staticClass:"line-number"},[s._v("71")]),t("br"),t("span",{staticClass:"line-number"},[s._v("72")]),t("br"),t("span",{staticClass:"line-number"},[s._v("73")]),t("br"),t("span",{staticClass:"line-number"},[s._v("74")]),t("br"),t("span",{staticClass:"line-number"},[s._v("75")]),t("br")])]),t("p",[s._v("我们正常运行程序，然后同时打开浏览器，")]),s._v(" "),t("p",[s._v("输入地址："),t("a",{attrs:{href:"http://127.0.0.1:10000/debug/pprof/heap?debug=1",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://127.0.0.1:10000/debug/pprof/heap?debug=1"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("浏览器的内容其中有一部分如下，记录了目前的内存情况")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("#")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# runtime.MemStats")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Alloc = 228248")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# TotalAlloc = 1293696976")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Sys = 834967896")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Lookups = 0")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Mallocs = 2018")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Frees = 671")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HeapAlloc = 228248")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HeapSys = 804913152")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HeapIdle = 804102144")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HeapInuse = 811008")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HeapReleased = 108552192")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# HeapObjects = 1347")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# Stack = 360448 / 360448")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# MSpan = 28288 / 32768")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# MCache = 3472 / 16384")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# BuckHashSys = 1449617")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# GCSys = 27418976")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# OtherSys = 776551")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# NextGC = 4194304")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("# LastGC = 1583203571137891390")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br")])]),t("h3",{attrs:{id:"场景3-如何分析golang程序的cpu性能情况"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#场景3-如何分析golang程序的cpu性能情况"}},[s._v("#")]),s._v(" 场景3: 如何分析Golang程序的CPU性能情况？")]),s._v(" "),t("h4",{attrs:{id:"_1-性能分析注意事项"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1-性能分析注意事项"}},[s._v("#")]),s._v(" (1)性能分析注意事项")]),s._v(" "),t("p",[s._v("●  性能分析必须在一个\n可重复的、稳定的环境中来进行。\n○ 机器必须闲置\n■ 不要在共享硬件上进行性能分析;\n■ 不要在性能分析期间，在同一个机器上去浏览网页\n○ 注意省电模式和过热保护，如果突然进入这些模式，会导致分析数据严重不准确\n○ 不要使用虚拟机、共享的云主机，太多干扰因素，分析数据会很不一致；\n○ 不要在 macOS 10.11 及以前的版本运行性能分析，有 bug，之后的版本修复了。")]),s._v(" "),t("p",[s._v("如果承受得起，购买专用的性能测试分析的硬件设备，上架。")]),s._v(" "),t("p",[s._v("● 关闭电源管理、过热管理;\n● 绝不要升级，以保证测试的一致性，以及具有可比性。")]),s._v(" "),t("p",[s._v("如果没有这样的环境，那就一定要在多个环境中，执行多次，以取得可参考的、具有相对一致性的测试结果。")]),s._v(" "),t("h4",{attrs:{id:"_2-cpu性能分析"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2-cpu性能分析"}},[s._v("#")]),s._v(" (2) CPU性能分析")]),s._v(" "),t("p",[s._v("我们来用下面的代码进行测试")]),s._v(" "),t("p",[s._v("demo4.go")]),s._v(" "),t("div",{staticClass:"language-go line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-go"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("package")]),s._v(" main\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"bytes"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"math/rand"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"time"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"log"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"net/http"')]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("_")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"net/http/pprof"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("test")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" ===> loop begin."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("genSomeBytes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    log"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Println")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('" ===> loop end."')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//生成一个随机字符串")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("genSomeBytes")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v("bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Buffer "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" buff bytes"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Buffer\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20000")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        buff"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Write")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),t("span",{pre:!0,attrs:{class:"token builtin"}},[s._v("byte")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),t("span",{pre:!0,attrs:{class:"token char"}},[s._v("'0'")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("byte")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("rand"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Intn")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("return")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&")]),s._v("buff\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("go")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("func")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("test")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n            time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("Sleep")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("time"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("Second "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n    "),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//启动pprof")]),s._v("\n    http"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("ListenAndServe")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0:10000"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("nil")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br"),t("span",{staticClass:"line-number"},[s._v("25")]),t("br"),t("span",{staticClass:"line-number"},[s._v("26")]),t("br"),t("span",{staticClass:"line-number"},[s._v("27")]),t("br"),t("span",{staticClass:"line-number"},[s._v("28")]),t("br"),t("span",{staticClass:"line-number"},[s._v("29")]),t("br"),t("span",{staticClass:"line-number"},[s._v("30")]),t("br"),t("span",{staticClass:"line-number"},[s._v("31")]),t("br"),t("span",{staticClass:"line-number"},[s._v("32")]),t("br"),t("span",{staticClass:"line-number"},[s._v("33")]),t("br"),t("span",{staticClass:"line-number"},[s._v("34")]),t("br"),t("span",{staticClass:"line-number"},[s._v("35")]),t("br"),t("span",{staticClass:"line-number"},[s._v("36")]),t("br"),t("span",{staticClass:"line-number"},[s._v("37")]),t("br"),t("span",{staticClass:"line-number"},[s._v("38")]),t("br"),t("span",{staticClass:"line-number"},[s._v("39")]),t("br"),t("span",{staticClass:"line-number"},[s._v("40")]),t("br"),t("span",{staticClass:"line-number"},[s._v("41")]),t("br"),t("span",{staticClass:"line-number"},[s._v("42")]),t("br"),t("span",{staticClass:"line-number"},[s._v("43")]),t("br"),t("span",{staticClass:"line-number"},[s._v("44")]),t("br"),t("span",{staticClass:"line-number"},[s._v("45")]),t("br"),t("span",{staticClass:"line-number"},[s._v("46")]),t("br")])]),t("p",[s._v("这里面还是启动了pprof的坚挺,有关pprof启动的代码如下")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("import")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"net/http"')]),s._v("\n    _ "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"net/http/pprof"')]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n\nfunc "),t("span",{pre:!0,attrs:{class:"token function-name function"}},[s._v("main")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n //"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  //"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("..")]),s._v(".\n  \n  //启动pprof\n  http.ListenAndServe"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"0.0.0.0:10000"')]),s._v(", nil"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br")])]),t("p",[s._v("main()里的流程很简单,启动一个goroutine去无限循环调用test()方法,休眠1s.")]),s._v(" "),t("p",[s._v("test()的流程是生成1000个20000个字符的随机字符串.并且打印.")]),s._v(" "),t("p",[s._v("我们将上面的代码编译成可执行的二进制文件 demo4(记住这个名字,稍后我们能用到)")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ go build demo4.go\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("接下来我们启动程序,程序会无限循环的打印字符串.")]),s._v(" "),t("p",[s._v("接下来我们通过几种方式来查看进程的cpu性能情况.")]),s._v(" "),t("h5",{attrs:{id:"a-web界面查看"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#a-web界面查看"}},[s._v("#")]),s._v(" A. Web界面查看")]),s._v(" "),t("p",[s._v("浏览器访问"),t("a",{attrs:{href:"http://127.0.0.1:10000/debug/pprof/",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://127.0.0.1:10000/debug/pprof/"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("我们会看到如下画面")]),s._v(" "),t("p",[s._v("这里面能够通过pprof查看包括(阻塞信息、cpu信息、内存堆信息、锁信息、goroutine信息等等), 我们这里关心的cpu的性能的profile信息.")]),s._v(" "),t("p",[s._v("有关profile下面的英文解释大致如下:")]),s._v(" "),t("p",[s._v("“CPU配置文件。您可以在秒GET参数中指定持续时间。获取概要文件后，请使用go tool pprof命令调查概要文件。”")]),s._v(" "),t("p",[s._v("所以我们要是想得到cpu性能,就是要获取到当前进程的profile文件,这个文件默认是30s生成一个,所以你的程序要至少运行30s以上(这个参数也可以修改,稍后我们介绍)")]),s._v(" "),t("p",[s._v("我们可以直接点击网页的profile,浏览器会给我们下载一个profile文件. 记住这个文件的路径, 可以拷贝到与demo4所在的同一文件夹下.")]),s._v(" "),t("h5",{attrs:{id:"b-使用pprof工具查看"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#b-使用pprof工具查看"}},[s._v("#")]),s._v(" B. 使用pprof工具查看")]),s._v(" "),t("p",[s._v("pprof 的格式如下")]),s._v(" "),t("p",[s._v("go tool pprof [binary] [profile]")]),s._v(" "),t("p",[s._v("binary: 必须指向生成这个性能分析数据的那个二进制可执行文件；")]),s._v(" "),t("p",[s._v("profile: 必须是该二进制可执行文件所生成的性能分析数据文件。")]),s._v(" "),t("p",[s._v("binary 和 profile 必须严格匹配。")]),s._v(" "),t("p",[s._v("我们来查看一下:")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ go tool pprof ./demo4 profile\n\nFile: demo4\nType: cpu\nTime: Mar "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" at "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":18pm "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CST"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nDuration: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(".13s, Total samples "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(".27s "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.81")]),s._v("%"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nEntering interactive mode "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("type "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"help"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" commands, "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"o"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" options"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pprof"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br")])]),t("p",[s._v("help可以查看一些指令,我么可以通过top来查看cpu的性能情况.")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pprof"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\nShowing nodes accounting "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" 8420ms, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("84.79")]),s._v("% of 9930ms total\nDropped "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("116")]),s._v(" nodes "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cum "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("49")]),s._v(".65ms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nShowing "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" nodes out of "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("83")]),s._v("\n      flat  flat%   sum%        cum   cum%\n    2190ms "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22.05")]),s._v("% "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("22.05")]),s._v("%     4350ms "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("43.81")]),s._v("%  math/rand."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("*Rand"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".Int31n\n    1530ms "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15.41")]),s._v("% "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("37.46")]),s._v("%     5880ms "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("59.21")]),s._v("%  math/rand."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("*Rand"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".Intn\n    1240ms "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12.49")]),s._v("% "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("49.95")]),s._v("%     1240ms "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12.49")]),s._v("%  sync."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("*Mutex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".Unlock "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("inline"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    1130ms "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11.38")]),s._v("% "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("61.33")]),s._v("%     1170ms "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11.78")]),s._v("%  syscall.Syscall\n     610ms  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.14")]),s._v("% "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("67.47")]),s._v("%     2060ms "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.75")]),s._v("%  math/rand."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("*lockedSource"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".Int63\n     550ms  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.54")]),s._v("% "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("73.01")]),s._v("%     7500ms "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("75.53")]),s._v("%  main.genSomeBytes\n     420ms  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.23")]),s._v("% "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("77.24")]),s._v("%      990ms  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.97")]),s._v("%  bytes."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("*Buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".Write\n     280ms  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.82")]),s._v("% "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("80.06")]),s._v("%      280ms  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.82")]),s._v("%  runtime.futex\n     240ms  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.42")]),s._v("% "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("82.48")]),s._v("%      240ms  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.42")]),s._v("%  runtime.usleep\n     230ms  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.32")]),s._v("% "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("84.79")]),s._v("%      230ms  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2.32")]),s._v("%  runtime.memmove\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pprof"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" \n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br")])]),t("p",[s._v("这里面有几列数据,需要说明一下.")]),s._v(" "),t("p",[s._v("● flat：当前函数占用CPU的耗时\n● flat：:当前函数占用CPU的耗时百分比\n● sun%：函数占用CPU的耗时累计百分比\n● cum：当前函数加上调用当前函数的函数占用CPU的总耗时\n● cum%：当前函数加上调用当前函数的函数占用CPU的总耗时百分比\n● 最后一列：函数名称")]),s._v(" "),t("p",[s._v("通过结果我们可以看出, 该程序的大部分cpu性能消耗在 main.getSomeBytes()方法中,其中math/rand取随机数消耗比较大.")]),s._v(" "),t("h5",{attrs:{id:"c-通过go-tool-pprof得到profile文件"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#c-通过go-tool-pprof得到profile文件"}},[s._v("#")]),s._v(" C. 通过go tool pprof得到profile文件")]),s._v(" "),t("p",[s._v("我们上面的profile文件是通过web浏览器下载的,这个profile的经过时间是30s的,默认值我们在浏览器上修改不了,如果你想得到时间更长的cpu利用率,可以通过go tool pprof指令与程序交互来获取到")]),s._v(" "),t("p",[s._v("首先,我们先启动程序")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$./demo4\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("然后再打开一个终端")]),s._v(" "),t("p",[s._v("go tool pprof "),t("a",{attrs:{href:"http://localhost:10000/debug/pprof/profile?seconds=60",target:"_blank",rel:"noopener noreferrer"}},[s._v("http://localhost:10000/debug/pprof/profile?seconds=60"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("这里制定了生成profile文件的时间间隔60s")]),s._v(" "),t("p",[s._v("等待60s之后, 终端就会有结果出来,我们继续使用top来查看.")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ go tool pprof "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("http://localhost:10000/debug/pprof/profile?seconds"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v("\nFetching profile over HTTP from "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v("http://localhost:10000/debug/pprof/profile?seconds"),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),t("span",{pre:!0,attrs:{class:"token operator"}},[t("span",{pre:!0,attrs:{class:"token file-descriptor important"}},[s._v("0")]),s._v(">")]),s._v("\nSaved profile "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("in")]),s._v(" /home/itheima/pprof/pprof.demo4.samples.cpu.005.pb.gz\nFile: demo4\nType: cpu\nTime: Mar "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" at "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":59pm "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CST"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nDuration: 1mins, Total samples "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("12")]),s._v(".13s "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.22")]),s._v("%"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nEntering interactive mode "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("type "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"help"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" commands, "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"o"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" options"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pprof"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v("\nShowing nodes accounting "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" 9940ms, "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("81.95")]),s._v("% of 12130ms total\nDropped "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("110")]),s._v(" nodes "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("cum "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60")]),s._v(".65ms"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nShowing "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("top")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10")]),s._v(" nodes out of "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("56")]),s._v("\n      flat  flat%   sum%        cum   cum%\n    2350ms "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19.37")]),s._v("% "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("19.37")]),s._v("%     4690ms "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("38.66")]),s._v("%  math/rand."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("*lockedSource"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".Int63\n    1770ms "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.59")]),s._v("% "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("33.97")]),s._v("%     1770ms "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("14.59")]),s._v("%  sync."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("*Mutex"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".Unlock "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("inline"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    1290ms "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("10.63")]),s._v("% "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("44.60")]),s._v("%     6040ms "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("49.79")]),s._v("%  math/rand."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("*Rand"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".Int31n\n    1110ms  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.15")]),s._v("% "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("53.75")]),s._v("%     1130ms  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("9.32")]),s._v("%  syscall.Syscall\n     810ms  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6.68")]),s._v("% "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("60.43")]),s._v("%     1860ms "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("15.33")]),s._v("%  bytes."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("*Buffer"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".Write\n     620ms  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("5.11")]),s._v("% "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("65.54")]),s._v("%     6660ms "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("54.91")]),s._v("%  math/rand."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("*Rand"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".Intn\n     570ms  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.70")]),s._v("% "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("70.24")]),s._v("%      570ms  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.70")]),s._v("%  runtime.procyield\n     500ms  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("4.12")]),s._v("% "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("74.36")]),s._v("%     9170ms "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("75.60")]),s._v("%  main.genSomeBytes\n     480ms  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.96")]),s._v("% "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("78.32")]),s._v("%      480ms  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.96")]),s._v("%  runtime.memmove\n     440ms  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.63")]),s._v("% "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("81.95")]),s._v("%      440ms  "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3.63")]),s._v("%  math/rand."),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("*rngSource"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(".Uint64\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pprof"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br"),t("span",{staticClass:"line-number"},[s._v("7")]),t("br"),t("span",{staticClass:"line-number"},[s._v("8")]),t("br"),t("span",{staticClass:"line-number"},[s._v("9")]),t("br"),t("span",{staticClass:"line-number"},[s._v("10")]),t("br"),t("span",{staticClass:"line-number"},[s._v("11")]),t("br"),t("span",{staticClass:"line-number"},[s._v("12")]),t("br"),t("span",{staticClass:"line-number"},[s._v("13")]),t("br"),t("span",{staticClass:"line-number"},[s._v("14")]),t("br"),t("span",{staticClass:"line-number"},[s._v("15")]),t("br"),t("span",{staticClass:"line-number"},[s._v("16")]),t("br"),t("span",{staticClass:"line-number"},[s._v("17")]),t("br"),t("span",{staticClass:"line-number"},[s._v("18")]),t("br"),t("span",{staticClass:"line-number"},[s._v("19")]),t("br"),t("span",{staticClass:"line-number"},[s._v("20")]),t("br"),t("span",{staticClass:"line-number"},[s._v("21")]),t("br"),t("span",{staticClass:"line-number"},[s._v("22")]),t("br"),t("span",{staticClass:"line-number"},[s._v("23")]),t("br"),t("span",{staticClass:"line-number"},[s._v("24")]),t("br")])]),t("p",[s._v("依然会得到cpu性能的结果, 我们发现这次的结果与上次30s的结果百分比类似.")]),s._v(" "),t("h5",{attrs:{id:"d-可视化查看"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#d-可视化查看"}},[s._v("#")]),s._v(" D.可视化查看")]),s._v(" "),t("p",[s._v("我们还是通过")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("go tool pprof ./demo4 profile\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("进入profile文件查看,然后我们输入web指令.")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("$ go tool pprof ./demo4 profileFile: demo4\nType: cpu\nTime: Mar "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),s._v(", "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("2020")]),s._v(" at "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("11")]),s._v(":18pm "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("CST"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nDuration: "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("30")]),s._v(".13s, Total samples "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("6")]),s._v(".27s "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("20.81")]),s._v("%"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\nEntering interactive mode "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("type "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"help"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" commands, "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"o"')]),s._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" options"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("pprof"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" web\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br"),t("span",{staticClass:"line-number"},[s._v("2")]),t("br"),t("span",{staticClass:"line-number"},[s._v("3")]),t("br"),t("span",{staticClass:"line-number"},[s._v("4")]),t("br"),t("span",{staticClass:"line-number"},[s._v("5")]),t("br"),t("span",{staticClass:"line-number"},[s._v("6")]),t("br")])]),t("p",[s._v("这里如果报找不到graphviz工具,需要安装一下")]),s._v(" "),t("p",[s._v("Ubuntu安装")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[t("span",{pre:!0,attrs:{class:"token variable"}},[s._v("$sudo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("apt-get")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" graphviz\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("Mac安装")]),s._v(" "),t("div",{staticClass:"language-shell line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-shell"}},[t("code",[s._v("brew "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v(" graphviz\n")])]),s._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[s._v("1")]),t("br")])]),t("p",[s._v("windows安装")]),s._v(" "),t("p",[s._v("下载"),t("a",{attrs:{href:"https://graphviz.gitlab.io/_pages/Download/Download_windows.html",target:"_blank",rel:"noopener noreferrer"}},[s._v("https://graphviz.gitlab.io/_pages/Download/Download_windows.html"),t("OutboundLink")],1)]),s._v(" "),t("p",[s._v("将graphviz安装目录下的bin文件夹添加到Path环境变量中。 在终端输入dot -version查看是否安装成功。")]),s._v(" "),t("p",[s._v("然后我们得到一个svg的可视化文件在/tmp路径下")]),s._v(" "),t("p",[s._v("这样我们就能比较清晰的看到函数之间的调用关系,方块越大的表示cpu的占用越大.")]),s._v(" "),t("h3",{attrs:{id:"参考"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#参考"}},[s._v("#")]),s._v(" 参考")]),s._v(" "),t("p",[t("a",{attrs:{href:"https://www.yuque.com/aceld/golang/ga6pb1",target:"_blank",rel:"noopener noreferrer"}},[s._v("最常用的调试 golang 的 bug 以及性能问题的实践方法"),t("OutboundLink")],1)])])}),[],!1,null,null,null);t.default=e.exports}}]);