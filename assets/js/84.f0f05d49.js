(window.webpackJsonp=window.webpackJsonp||[]).push([[84],{423:function(t,_,v){"use strict";v.r(_);var a=v(0),s=Object(a.a)({},(function(){var t=this,_=t._self._c;return _("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[_("h3",{attrs:{id:"引言"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#引言"}},[t._v("#")]),t._v(" 引言")]),t._v(" "),_("p",[t._v("平时无论是生活，还是工作中。我们浏览网页都逃不开一个个的http请求，同时在面试上也经常会被问及："),_("strong",[t._v("简单说说一次http请求的整个流程")]),t._v("？下面也是基于这个点，结合已掌握的知识，这里把相关的流程简单讲一下。")]),t._v(" "),_("h3",{attrs:{id:"_1-获取ip"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_1-获取ip"}},[t._v("#")]),t._v(" 1. 获取IP")]),t._v(" "),_("ul",[_("li",[t._v("静态配置")]),t._v(" "),_("li",[t._v("动态配置（DHCP）\n"),_("img",{attrs:{src:"https://pic.fengyuwusong.cn/20220429105727.png",alt:"DHCP流程"}})])]),t._v(" "),_("p",[t._v("后续续约流程重复流程3、4即可。")]),t._v(" "),_("h3",{attrs:{id:"_2-域名解析"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_2-域名解析"}},[t._v("#")]),t._v(" 2. 域名解析")]),t._v(" "),_("p",[t._v("浏览器缓存->系统缓存【本地dns解析】->请求dns服务器")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://pic.fengyuwusong.cn/20220429102332.png",alt:"dns解析流程"}})]),t._v(" "),_("ul",[_("li",[_("p",[t._v("思考题：")])]),t._v(" "),_("li",[_("p",[t._v("dns用途：")]),t._v(" "),_("ul",[_("li",[t._v("域名解析")]),t._v(" "),_("li",[t._v("负载均衡【内部&全局(GSLB)运营商+地域等】")])])]),t._v(" "),_("li",[_("p",[t._v("传统dns协议VS httpdns")]),t._v(" "),_("ul",[_("li",[t._v("缓存问题")]),t._v(" "),_("li",[t._v("域名转发")]),t._v(" "),_("li",[t._v("出口NAT问题")]),t._v(" "),_("li",[t._v("域名更新")]),t._v(" "),_("li",[t._v("延迟问题\n"),_("img",{attrs:{src:"https://pic.fengyuwusong.cn/20220429103748.png",alt:"httpdns"}})])])])]),t._v(" "),_("h3",{attrs:{id:"_3-判断目标机器是否在同一个局域网内"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_3-判断目标机器是否在同一个局域网内"}},[t._v("#")]),t._v(" 3. 判断目标机器是否在同一个局域网内")]),t._v(" "),_("ul",[_("li",[_("p",[t._v("CIDR网络无类型域间选路（CIDR）\n例如：10.100.122.2/24\n网段：10.100.122.2 广播地址：10.100.122.255 子网掩码：255.255.255.0")])]),t._v(" "),_("li",[_("p",[t._v("思考题")]),t._v(" "),_("ul",[_("li",[t._v("跨网段的请求，应该要怎么发起？\n如果这是一个跨网段的调用，它便不会直接将包发送到网络上，而是企图将包发送到网关。")])])])]),t._v(" "),_("h3",{attrs:{id:"_4-获取网关mac地址"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_4-获取网关mac地址"}},[t._v("#")]),t._v(" 4. 获取网关MAC地址")]),t._v(" "),_("p",[t._v("ARP协议")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://pic.fengyuwusong.cn/20220429110903.png",alt:"arp协议"}})]),t._v(" "),_("ul",[_("li",[t._v("思考题：\n"),_("ul",[_("li",[t._v("mac层用来解决什么问题的？")]),t._v(" "),_("li",[t._v("多个交换机arp会出现什么问题，怎么解决？【环路】")])])])]),t._v(" "),_("h3",{attrs:{id:"_5-tcp链接"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_5-tcp链接"}},[t._v("#")]),t._v(" 5. TCP链接")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://pic.fengyuwusong.cn/20220429111900.png",alt:"三次握手流程"}})]),t._v(" "),_("ul",[_("li",[t._v("思考题：\n"),_("ul",[_("li",[t._v("为什么需要三次握手？")]),t._v(" "),_("li",[t._v("握手除了建立连接，还做了哪个比较重要的事情？")])])])]),t._v(" "),_("h3",{attrs:{id:"_6-构建报文"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_6-构建报文"}},[t._v("#")]),t._v(" 6. 构建报文")]),t._v(" "),_("p",[t._v("发起请求的第一步，应该是构建需要发出去的报文，基于"),_("strong",[t._v("网络5层协议")]),t._v("，当我们准备发出一个HTTP报文的时候，整个报文的构建应该是基于网络协议自顶向下进行构建的。")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://pic.fengyuwusong.cn/20220428225605.png",alt:"报文构建过程"}})]),t._v(" "),_("p",[t._v("以一个简单的http报文为例，首先他应该是先构建HTTP报文")]),t._v(" "),_("ol",[_("li",[t._v("应用层：http请求报文构建")])]),t._v(" "),_("p",[_("img",{attrs:{src:"https://mdn.mozillademos.org/files/13687/HTTP_Request.png",alt:"http报文"}})]),t._v(" "),_("ol",{attrs:{start:"2"}},[_("li",[t._v("运输层：数据报")])]),t._v(" "),_("p",[_("img",{attrs:{src:"https://pic.fengyuwusong.cn/20220428231757.png",alt:"tcp包"}})]),t._v(" "),_("ol",{attrs:{start:"3"}},[_("li",[_("p",[t._v("网络层：ip帧\n``\n"),_("img",{attrs:{src:"https://pic.fengyuwusong.cn/20220428231549.png",alt:"ip帧"}})])]),t._v(" "),_("li",[_("p",[t._v("数据链路层：MAC帧")])])]),t._v(" "),_("p",[_("img",{attrs:{src:"https://pic.fengyuwusong.cn/20220428230749.png",alt:"数据链路包"}})]),t._v(" "),_("ol",{attrs:{start:"5"}},[_("li",[t._v("物理层：二进制流")])]),t._v(" "),_("p",[t._v("整体包：\n"),_("img",{attrs:{src:"https://pic.fengyuwusong.cn/20220429114343.png",alt:""}})]),t._v(" "),_("h3",{attrs:{id:"_7-报文在网络中应该如何转发"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_7-报文在网络中应该如何转发"}},[t._v("#")]),t._v(" 7. 报文在网络中应该如何转发")]),t._v(" "),_("h4",{attrs:{id:"无nat模式"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#无nat模式"}},[t._v("#")]),t._v(" - 无nat模式")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://pic.fengyuwusong.cn/20220429113536.png",alt:"无nat转发"}})]),t._v(" "),_("p",[t._v("服务器A发送请求到服务器B包内容应依序为：")]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("序号")]),t._v(" "),_("th",[t._v("源ip")]),t._v(" "),_("th",[t._v("源mac")]),t._v(" "),_("th",[t._v("目标ip")]),t._v(" "),_("th",[t._v("目标mac")]),t._v(" "),_("th",[t._v("备注")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("192.168.1.101")]),t._v(" "),_("td",[t._v("服务器A的mac地址")]),t._v(" "),_("td",[t._v("192.168.4.101")]),t._v(" "),_("td",[t._v("网关192.168.1.1的mac地址")]),t._v(" "),_("td",[t._v("网段不同，修改mac地址发到网关")])]),t._v(" "),_("tr",[_("td",[t._v("2")]),t._v(" "),_("td",[t._v("192.168.1.101")]),t._v(" "),_("td",[t._v("192.168.56.1的mac地址")]),t._v(" "),_("td",[t._v("192.168.4.101")]),t._v(" "),_("td",[t._v("网关192.168.56.2的mac地址")]),t._v(" "),_("td",[t._v("查询本机路由表，下一跳为192.168.56.2的交换机，arp查询该机器mac地址")])]),t._v(" "),_("tr",[_("td",[t._v("3")]),t._v(" "),_("td",[t._v("192.168.1.101")]),t._v(" "),_("td",[t._v("网关192.168.4.1的mac地址")]),t._v(" "),_("td",[t._v("192.168.4.101")]),t._v(" "),_("td",[t._v("服务器B的mac地址")]),t._v(" "),_("td",[t._v("查询路由表或arp，转发到目标服务器B")])])])]),t._v(" "),_("h4",{attrs:{id:"有nat模式"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#有nat模式"}},[t._v("#")]),t._v(" - 有nat模式")]),t._v(" "),_("p",[t._v("局域网之间无协商，各定各的网段，存在ip段冲突。")]),t._v(" "),_("p",[_("img",{attrs:{src:"https://pic.fengyuwusong.cn/20220429113839.png",alt:"有nat转发"}})]),t._v(" "),_("p",[t._v("服务器A发送请求到服务器B包内容应依序为：")]),t._v(" "),_("table",[_("thead",[_("tr",[_("th",[t._v("序号")]),t._v(" "),_("th",[t._v("源ip")]),t._v(" "),_("th",[t._v("源mac")]),t._v(" "),_("th",[t._v("目标ip")]),t._v(" "),_("th",[t._v("目标mac")]),t._v(" "),_("th",[t._v("备注")])])]),t._v(" "),_("tbody",[_("tr",[_("td",[t._v("1")]),t._v(" "),_("td",[t._v("192.168.1.101")]),t._v(" "),_("td",[t._v("服务器A的mac地址")]),t._v(" "),_("td",[t._v("192.168.56.2")]),t._v(" "),_("td",[t._v("网关192.168.1.1的mac地址")]),t._v(" "),_("td",[t._v("网段不同，修改mac地址发到网关")])]),t._v(" "),_("tr",[_("td",[t._v("2")]),t._v(" "),_("td",[t._v("192.168.56.1")]),t._v(" "),_("td",[t._v("192.168.56.1的mac地址")]),t._v(" "),_("td",[t._v("192.168.56.2")]),t._v(" "),_("td",[t._v("网关192.168.56.2的mac地址")]),t._v(" "),_("td",[t._v("修改源ip，以交换机ip发送请求到网关192.168.56.2  "),_("strong",[t._v("nat过程中，网络包从局域网转发时，需要变更源ip，否则无法确认身份")])])]),t._v(" "),_("tr",[_("td",[t._v("3")]),t._v(" "),_("td",[t._v("192.168.56.1")]),t._v(" "),_("td",[t._v("网关192.168.1.1的mac地址")]),t._v(" "),_("td",[t._v("192.168.1.101")]),t._v(" "),_("td",[t._v("服务器B的mac地址")]),t._v(" "),_("td",[t._v("网关根据NAT配置，来源ip是192.168.56.2的通通转发到服务器B")])])])]),t._v(" "),_("ul",[_("li",[t._v("思考题：\n"),_("ul",[_("li",[t._v("以上介绍的nat方式是使用中间局域网身份方式进行映射，那么存在ip耗尽的危险，目前是如何规避的呢？【NAPT】")])])])]),t._v(" "),_("h3",{attrs:{id:"_8-路由转发"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#_8-路由转发"}},[t._v("#")]),t._v(" 8. 路由转发")]),t._v(" "),_("p",[t._v("第7点关于路由跳转描述都是很简单的场景（仅一条映射关系），但是在实际的网络世界上要复杂很多，一旦出了网关，会面临很多的路由，需要如何选择更快速的通道？")]),t._v(" "),_("ul",[_("li",[t._v("静态路由策略")]),t._v(" "),_("li",[t._v("动态路由策略\n"),_("ul",[_("li",[t._v("距离矢量算法【维护到任意路由的距离路由表，定期广播所有路由表】（BGP：外网路由协议）\n"),_("ul",[_("li",[t._v("收敛慢【包含路径解决】")]),t._v(" "),_("li",[t._v("发送需广播全部路由表【不适用于大型网络规模】")])])]),t._v(" "),_("li",[t._v("链路状态路由算法【根据收包的方式计算临近路由距离,可维护一个完整的图，然后使用Dijkstra算法计算最短路径】（OSPF：内部网关协议）")])])])]),t._v(" "),_("h3",{attrs:{id:"扩展思考"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#扩展思考"}},[t._v("#")]),t._v(" 扩展思考")]),t._v(" "),_("p",[t._v("读完上文，大家对发起一个请求协议在网络中的流转流程应该有了大致的了解，那么这里再简单拓展一下提问：")]),t._v(" "),_("ol",[_("li",[t._v("为什么有了ip还需要mac地址？")]),t._v(" "),_("li",[t._v("https应该加上哪些流程？")]),t._v(" "),_("li",[t._v("移动设备的ip怎么获取的？")]),t._v(" "),_("li",[t._v("有哪些技术是用于服务端相应提升的？")]),t._v(" "),_("li",[t._v(".............")])]),t._v(" "),_("h3",{attrs:{id:"参考文档"}},[_("a",{staticClass:"header-anchor",attrs:{href:"#参考文档"}},[t._v("#")]),t._v(" 参考文档")]),t._v(" "),_("p",[t._v("http协议文档: "),_("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/HTTP",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://developer.mozilla.org/en-US/docs/Web/HTTP"),_("OutboundLink")],1),t._v("\n极客时间课-趣谈网络协议："),_("a",{attrs:{href:"https://time.geekbang.org/column/intro/100007101",target:"_blank",rel:"noopener noreferrer"}},[t._v("https://time.geekbang.org/column/intro/100007101"),_("OutboundLink")],1)])])}),[],!1,null,null,null);_.default=s.exports}}]);